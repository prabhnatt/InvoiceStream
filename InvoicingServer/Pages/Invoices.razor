@page "/invoices"
@attribute [Authorize]

@inject ApiClient ApiClient
@inject IConfiguration Config

@using InvoicingCore.Enums
@using InvoicingServer.Services
@using InvoicingCore.Contracts.Invoices
@using InvoicingCore.Contracts.Clients
@using InvoicingCore.Models
@using System.Net.Http.Json
@using Microsoft.AspNetCore.Components

<h2>Invoices</h2>

@if (_isLoading)
{
    <p>Loading...</p>
}
else
{
    <div class="invoices-page">
        <!-- LEFT: LIST -->
        <div class="invoices-list-pane">
            <div class="toolbar">
                <div class="d-flex gap-2 mb-2">
                    <input class="form-control form-control-sm"
                           placeholder="Search by client or #..."
                           @bind="_search" @bind:event="oninput" />

                    <select class="form-select form-select-sm w-auto" @bind="_statusFilter">
                        <option value="">All</option>
                        @foreach (var s in Enum.GetValues<InvoiceStatus>())
                        {
                            <option value="@s">@s</option>
                        }
                    </select>
                </div>

                <button class="btn btn-success w-100" @onclick="CreateNewInvoice">
                    + New Invoice
                </button>
            </div>

            <div class="invoices-list">
                @if (!FilteredInvoices.Any())
                {
                    <div class="empty-state">
                        <p>No invoices found.</p>
                        <p class="hint">Create your first invoice to get started.</p>
                    </div>
                }
                else
                {
                    @foreach (var inv in FilteredInvoices.OrderByDescending(i => i.InvoiceNumber))
                    {
                        var selected = _selectedInvoice != null && _selectedInvoice.Id == inv.Id;

                        <div class="invoice-card @(selected ? "selected" : "")"
                             @onclick="() => SelectInvoice(inv)">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <div class="invoice-num">
                                        INV-@inv.InvoiceNumber
                                    </div>
                                    <div class="invoice-client">
                                        @GetClientName(inv.ClientId)
                                    </div>
                                </div>
                                <div class="text-end">
                                    <div>@FormatMoney(inv.Totals.GrandTotal, inv.Currency)</div>
                                    <div class="invoice-date">@inv.IssueDate.ToString("yyyy-MM-dd")</div>
                                </div>
                            </div>
                            <div class="mt-1 d-flex justify-content-between">
                                <span class="badge @GetStatusBadgeClass(inv.Status)">
                                    @inv.Status
                                </span>
                                <small class="text-muted">
                                    Due @inv.DueDate.ToString("yyyy-MM-dd")
                                </small>
                            </div>
                        </div>
                    }
                }
            </div>
        </div>

        <!-- RIGHT: EDITOR -->
        <div class="invoices-editor-pane">
            @if (_editor is null)
            {
                <div class="empty-state">
                    <p>Select an invoice on the left or click "New Invoice".</p>
                </div>
            }
            else
            {
                <EditForm Model="_editor" OnValidSubmit="SaveInvoiceAsync">
                    <DataAnnotationsValidator />
                    <ValidationSummary />

                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div>
                            <h4 class="mb-0">
                                @(_editor.IsNew ? "New Invoice" : $"Invoice INV-{_editor.InvoiceNumber}")
                            </h4>
                            <div class="mt-1">
                                <span class="badge @GetStatusBadgeClass(_editor.Status)">
                                    @_editor.Status
                                </span>
                                @if (_editor.Status == InvoiceStatus.Sent && _editor.SentAtUtc.HasValue)
                                {
                                    <small class="text-muted ms-2">
                                        Sent @_editor.SentAtUtc.Value.ToLocalTime().ToString("yyyy-MM-dd HH:mm")
                                    </small>
                                }
                                @if (_editor.Status == InvoiceStatus.Paid && _editor.PaidAtUtc.HasValue)
                                {
                                    <small class="text-muted ms-2">
                                        Paid @_editor.PaidAtUtc.Value.ToLocalTime().ToString("yyyy-MM-dd HH:mm")
                                    </small>
                                }
                            </div>
                        </div>

                        <div class="text-end">
                            @if (!_editor.IsNew && !string.IsNullOrWhiteSpace(_apiBaseUrl))
                            {
                                var pdfMinimal = $"{_apiBaseUrl}/api/invoices/{_editor.Id}/pdf?style=minimal";
                                var pdfBusiness = $"{_apiBaseUrl}/api/invoices/{_editor.Id}/pdf?style=business";

                                <a class="btn btn-outline-light btn-sm me-1" href="@pdfMinimal" target="_blank">
                                    Minimal PDF
                                </a>
                                <a class="btn btn-outline-light btn-sm" href="@pdfBusiness" target="_blank">
                                    Business PDF
                                </a>
                            }
                        </div>
                    </div>

                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Client</label>
                            <InputSelect class="form-select" @bind-Value="_editor.ClientId" @onchange="OnClientChanged">
                                <option value="">Select client...</option>
                                @foreach (var c in _clients)
                                {
                                    <option value="@c.Id">@c.Name</option>
                                }
                            </InputSelect>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Issue Date</label>
                            <InputDate class="form-control" @bind-Value="_editor.IssueDate" />
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Due Date</label>
                            <InputDate class="form-control" @bind-Value="_editor.DueDate" />
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Currency</label>
                            <InputText class="form-control" @bind-Value="_editor.Currency" />
                        </div>
                    </div>

                    @if (!string.IsNullOrWhiteSpace(_selectedClientSummary))
                    {
                        <div class="alert alert-secondary mt-3">
                            @_selectedClientSummary
                        </div>
                    }

                    <div class="mt-3">
                        <h5>Line Items</h5>
                        <table class="table table-sm align-middle line-items-table">
                            <thead>
                                <tr>
                                    <th>Description</th>
                                    <th style="width: 90px;">Qty</th>
                                    <th style="width: 120px;">Unit</th>
                                    <th style="width: 100px;">Tax %</th>
                                    <th style="width: 120px;" class="text-end">Line Total</th>
                                    <th style="width: 40px;"></th>
                                </tr>
                            </thead>
                            <tbody>
                                @for (int i = 0; i < _editor.LineItems.Count; i++)
                                {
                                    var item = _editor.LineItems[i];
                                    <tr>
                                        <td>
                                            <InputText class="form-control form-control-sm"
                                                       @bind-Value="item.Description"
                                                       @bind-Value:event="oninput"
                                                       @onchange="RecalculateTotals" />
                                        </td>
                                        <td>
                                            <input type="number" step="0.01" class="form-control"
                                                   value="@item.Quantity"
                                                   @oninput="(e) =>
                                                   {
                                                       item.Quantity = !string.IsNullOrEmpty(e.Value?.ToString()) ? Convert.ToDecimal(e.Value) : (decimal)0;
                                                       RecalculateTotals();
                                                   }" />
                                        </td>
                                        <td>
                                            <input type="number" step="0.01" class="form-control"
                                                   value="@item.UnitPrice"
                                                   @oninput="(e) =>
                                                   {
                                                       item.UnitPrice = !string.IsNullOrEmpty(e.Value?.ToString()) ? Convert.ToDecimal(e.Value) : (decimal)0;
                                                       RecalculateTotals();
                                                   }" />
                                        </td>
                                        <td>
                                            <input type="number" step="0.01" class="form-control"
                                                   value="@item.TaxRate"
                                                   @oninput="(e) =>
                                                   {
                                                       item.UnitPrice = !string.IsNullOrEmpty(e.Value?.ToString()) ? Convert.ToDecimal(e.Value) : (decimal)0;
                                                       RecalculateTotals();
                                                   }" />
                                        </td>
                                        <td class="text-end">
                                            @FormatMoney(item.LineTotal, _editor.Currency)
                                        </td>
                                        <td>
                                            <button type="button"
                                                    class="btn btn-sm btn-link text-danger"
                                                    @onclick="() => RemoveLineItem(i)">
                                                ✕
                                            </button>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>

                        <button type="button" class="btn btn-outline-secondary btn-sm"
                                @onclick="AddLineItem">
                            + Add Line Item
                        </button>
                    </div>

                    <div class="mt-3 row">
                        <div class="col-md-6">
                            <label class="form-label">Notes (shown on invoice)</label>
                            <InputTextArea class="form-control" rows="3" @bind-Value="_editor.Notes" />
                        </div>
                        <div class="col-md-6 text-end">
                            <div class="totals-box">
                                <div class="d-flex justify-content-between">
                                    <span>Subtotal</span>
                                    <strong>@FormatMoney(_editor.SubTotal, _editor.Currency)</strong>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Tax</span>
                                    <strong>@FormatMoney(_editor.Tax, _editor.Currency)</strong>
                                </div>
                                <hr />
                                <div class="d-flex justify-content-between">
                                    <span>Total</span>
                                    <strong class="total-amount">
                                        @FormatMoney(_editor.Total, _editor.Currency)
                                    </strong>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="editor-footer mt-3">
                        <button type="submit" class="btn btn-success" disabled="@_isSaving">
                            @(_isSaving ? "Saving..." : "Save Invoice")
                        </button>

                        @if (!_editor.IsNew)
                        {
                            <button type="button"
                                    class="btn btn-outline-secondary ms-2"
                                    disabled="@_isSaving || _editor.Status == InvoiceStatus.Sent || _editor.Status == InvoiceStatus.Paid"
                                    @onclick="MarkAsSentAsync">
                                Mark as Sent
                            </button>

                            <button type="button"
                                    class="btn btn-outline-success ms-2"
                                    disabled="@_isSaving || _editor.Status == InvoiceStatus.Paid"
                                    @onclick="ShowMarkPaidPanel">
                                Mark as Paid
                            </button>
                        }
                    </div>

                    @if (_showMarkPaidPanel && !_editor.IsNew)
                    {
                        <div class="alert alert-secondary mt-3">
                            <div class="mb-2 fw-bold">Mark as Paid</div>

                            <div class="mb-2">
                                <label class="form-label">Payment Method</label>
                                <InputSelect class="form-select form-select-sm"
                                             @bind-Value="_editor.PaymentMethod">
                                    @foreach (var method in Enum.GetValues<PaymentMethod>())
                                    {
                                        <option value="@method">@method</option>
                                    }
                                </InputSelect>
                            </div>
                            <div class="mb-2">
                                <label class="form-label">Reference (optional)</label>
                                <InputText class="form-control form-control-sm"
                                           @bind-Value="_editor.PaymentReference" />
                            </div>

                            <button class="btn btn-success btn-sm me-2"
                                    @onclick="ConfirmMarkPaidAsync"
                                    disabled="@_isSaving">
                                Confirm
                            </button>
                            <button class="btn btn-link btn-sm" @onclick="() => _showMarkPaidPanel = false">
                                Cancel
                            </button>
                        </div>
                    }
                </EditForm>
            }
        </div>
    </div>
}

@code {
    private bool _isLoading = true;
    private bool _isSaving;
    private string _search = string.Empty;
    private string? _apiBaseUrl;
    private InvoiceStatus? _statusFilter;

    private BusinessProfile? _profile;
    private List<ClientResponse> _clients = new();
    private List<InvoiceResponse> _invoices = new();

    private InvoiceResponse? _selectedInvoice;
    private InvoiceEditorModel? _editor;
    private string? _selectedClientSummary;

    private bool _showMarkPaidPanel;

    private IEnumerable<InvoiceResponse> FilteredInvoices =>
        _invoices.Where(inv =>
        {
            var matchesStatus = !_statusFilter.HasValue || inv.Status == _statusFilter.Value;

            if (string.IsNullOrWhiteSpace(_search))
                return matchesStatus;

            var clientName = GetClientName(inv.ClientId) ?? "";
            var term = _search.Trim();

            return matchesStatus &&
                   (clientName.Contains(term, StringComparison.OrdinalIgnoreCase) ||
                    inv.InvoiceNumber.ToString().Contains(term, StringComparison.OrdinalIgnoreCase));
        });

    protected override async Task OnInitializedAsync()
    {
        _isLoading = true;

        _apiBaseUrl = Config["ApiBaseUrl"]?.TrimEnd('/');

        //profile
        var profileResponse = await ApiClient.GetAsync("/api/profile/me");
        if (profileResponse.IsSuccessStatusCode)
        {
            _profile = await profileResponse.Content.ReadFromJsonAsync<BusinessProfile>();
        }

        //clients
        var clientResponse = await ApiClient.GetAsync("/api/clients");
        clientResponse.EnsureSuccessStatusCode();
        _clients = await clientResponse.Content.ReadFromJsonAsync<List<ClientResponse>>() ?? new();

        //invoices
        var invResponse = await ApiClient.GetAsync("/api/invoices");
        invResponse.EnsureSuccessStatusCode();
        _invoices = await invResponse.Content.ReadFromJsonAsync<List<InvoiceResponse>>() ?? new();

        _isLoading = false;
    }

    private string? GetClientName(string clientId)
    {
        return _clients.FirstOrDefault(c => c.Id == clientId)?.Name ?? "(Unknown)";
    }

    private void CreateNewInvoice()
    {
        _selectedInvoice = null;

        var today = DateOnly.FromDateTime(DateTime.Today);

        var currency = _profile?.DefaultCurrency ?? "CAD";
        var taxRate = _profile?.DefaultTaxRate ?? 0.13m;
        var terms = _profile?.DefaultPaymentTermsDays ?? 14;

        _editor = new InvoiceEditorModel
        {
            ClientId = "",
            Status = InvoiceStatus.Draft,
            Type = InvoiceType.Invoice,
            IssueDate = today,
            DueDate = today.AddDays(terms),
            Currency = currency,
            LineItems = new List<InvoiceLineItemModel>
            {
                new InvoiceLineItemModel
                {
                    Description = "",
                    Quantity = 1,
                    UnitPrice = 0,
                    TaxRate = taxRate
                }
            }
        };

        _selectedClientSummary = null;
        RecalculateTotals();
    }

    private void SelectInvoice(InvoiceResponse inv)
    {
        _selectedInvoice = inv;

        _editor = new InvoiceEditorModel
        {
            Id = inv.Id,
            ClientId = inv.ClientId,
            InvoiceNumber = inv.InvoiceNumber,
            Status = inv.Status,
            Type = inv.Type,
            IssueDate = inv.IssueDate,
            DueDate = inv.DueDate,
            Currency = inv.Currency,
            Notes = inv.Notes,
            LineItems = inv.LineItems.Select(li => new InvoiceLineItemModel
            {
                Description = li.Description,
                Quantity = li.Quantity,
                UnitPrice = li.UnitPrice,
                TaxRate = li.TaxRate
            }).ToList(),
            SubTotal = inv.Totals.SubTotal,
            Tax = inv.Totals.Tax,
            Total = inv.Totals.GrandTotal,
            SentAtUtc = inv.SentAtUtc,
            PaidAtUtc = inv.PaidAtUtc,
            PaymentMethod = inv.PaymentMethod,
            PaymentReference = inv.PaymentReference
        };

        UpdateClientSummary();
        RecalculateTotals();
    }

    private void OnClientChanged(ChangeEventArgs _)
    {
        UpdateClientSummary();

        if (_editor is null)
            return;

        //Apply client defaults on new/draft invoices
        var client = _clients.FirstOrDefault(c => c.Id == _editor.ClientId);
        if (client is not null && _editor.Status == InvoiceStatus.Draft)
        {
            var currency = client.DefaultCurrency ?? _profile?.DefaultCurrency ?? _editor.Currency;
            var taxRate = client.DefaultTaxRate ?? _profile?.DefaultTaxRate ?? 0m;
            var terms = client.DefaultPaymentTermsDays ?? _profile?.DefaultPaymentTermsDays ?? 14;

            _editor.Currency = currency;

            var issue = _editor.IssueDate == default
                ? DateOnly.FromDateTime(DateTime.Today)
                : _editor.IssueDate;

            _editor.IssueDate = issue;
            _editor.DueDate = issue.AddDays(terms);

            foreach (var li in _editor.LineItems)
            {
                if (li.TaxRate <= 0)
                    li.TaxRate = taxRate;
            }

            RecalculateTotals();
        }
    }

    private void UpdateClientSummary()
    {
        if (_editor is null)
        {
            _selectedClientSummary = null;
            return;
        }

        var client = _clients.FirstOrDefault(c => c.Id == _editor.ClientId);
        if (client is null)
        {
            _selectedClientSummary = null;
            return;
        }

        var lines = new List<string>
        {
            client.Name
        };

        if (!string.IsNullOrWhiteSpace(client.PrimaryContactName))
        {
            var contact = client.PrimaryContactName;
            if (!string.IsNullOrWhiteSpace(client.PrimaryContactRole))
                contact += $" ({client.PrimaryContactRole})";
            lines.Add(contact);
        }

        if (!string.IsNullOrWhiteSpace(client.PrimaryEmail))
            lines.Add(client.PrimaryEmail);

        if (!string.IsNullOrWhiteSpace(client.Address?.ToString()))
            lines.Add(client.Address!.ToString());

        _selectedClientSummary = string.Join("\n", lines);
    }

    private void AddLineItem()
    {
        if (_editor is null) return;

        _editor.LineItems.Add(new InvoiceLineItemModel
        {
            Description = "",
            Quantity = 1,
            UnitPrice = 0,
            TaxRate = _profile?.DefaultTaxRate ?? 0.13m
        });

        RecalculateTotals();
    }

    private void RemoveLineItem(int index)
    {
        if (_editor is null) return;
        if (index < 0 || index >= _editor.LineItems.Count) return;

        _editor.LineItems.RemoveAt(index);
        RecalculateTotals();
    }

    private void RecalculateTotals()
    {
        if (_editor is null) return;

        decimal sub = 0;
        decimal tax = 0;

        foreach (var li in _editor.LineItems)
        {
            var baseAmount = li.Quantity * li.UnitPrice;
            var lineTax = baseAmount * li.TaxRate;
            li.LineTotal = baseAmount + lineTax;

            sub += baseAmount;
            tax += lineTax;
        }

        _editor.SubTotal = sub;
        _editor.Tax = tax;
        _editor.Total = sub + tax;
    }

    private async Task SaveInvoiceAsync()
    {
        if (_editor is null) return;

        _isSaving = true;

        try
        {
            HttpResponseMessage response;

            var request = new InvoiceCreateRequest
            {
                ClientId = _editor.ClientId,
                IssueDate = _editor.IssueDate,
                DueDate = _editor.DueDate,
                Currency = _editor.Currency,
                Status = _editor.Status,
                Type = _editor.Type,
                Notes = _editor.Notes,
                LineItems = _editor.LineItems.Select(li => new InvoiceLineItem
                {
                    Description = li.Description,
                    Quantity = li.Quantity,
                    UnitPrice = li.UnitPrice,
                    TaxRate = li.TaxRate
                }).ToList(),
                Totals = new InvoiceTotals
                {
                    SubTotal = _editor.SubTotal,
                    Tax = _editor.Tax,
                    GrandTotal = _editor.Total
                }
            };

            if (_editor.IsNew)
            {
                response = await ApiClient.PostAsJsonAsync("/api/invoices", request);
            }
            else
            {
                response = await ApiClient.PutAsJsonAsync($"/api/invoices/{_editor.Id}", request);
            }

            response.EnsureSuccessStatusCode();

            var updated = await response.Content.ReadFromJsonAsync<InvoiceResponse>();
            if (updated is null) return;

            ApplyUpdatedInvoice(updated);
        }
        finally
        {
            _isSaving = false;
        }
    }

    private async Task MarkAsSentAsync()
    {
        if (_editor is null || _editor.IsNew) return;

        _isSaving = true;

        try
        {
            var response = await ApiClient.PostEmptyAsync($"/api/invoices/{_editor.Id}/mark-sent");
            response.EnsureSuccessStatusCode();

            var updated = await response.Content.ReadFromJsonAsync<InvoiceResponse>();
            if (updated is null) return;

            ApplyUpdatedInvoice(updated);
        }
        finally
        {
            _isSaving = false;
        }
    }

    private void ShowMarkPaidPanel()
    {
        if (_editor is null || _editor.IsNew) return;
        _showMarkPaidPanel = true;
    }

    private async Task ConfirmMarkPaidAsync()
    {
        if (_editor is null || _editor.IsNew) return;

        _isSaving = true;

        try
        {
            var req = new MarkPaidRequest
            {
                PaymentMethod = _editor.PaymentMethod,
                PaymentReference = _editor.PaymentReference
            };

            var response = await ApiClient.PostAsJsonAsync($"/api/invoices/{_editor.Id}/mark-paid", req);
            response.EnsureSuccessStatusCode();

            var updated = await response.Content.ReadFromJsonAsync<InvoiceResponse>();
            if (updated is null) return;

            ApplyUpdatedInvoice(updated);
            _showMarkPaidPanel = false;
        }
        finally
        {
            _isSaving = false;
        }
    }

    private void ApplyUpdatedInvoice(InvoiceResponse updated)
    {
        var idx = _invoices.FindIndex(i => i.Id == updated.Id);
        if (idx >= 0)
            _invoices[idx] = updated;
        else
            _invoices.Add(updated);

        SelectInvoice(updated);
    }

    private string FormatMoney(decimal amount, string currency)
    {
        //Basic: you can improve this later with culture/currency-specific formatting
        return $"{currency} {amount:F2}";
    }

    private string GetStatusBadgeClass(InvoiceStatus status)
    {
        return status switch
        {
            InvoiceStatus.Draft => "bg-secondary",
            InvoiceStatus.Sent => "bg-info",
            InvoiceStatus.Paid => "bg-success",
            InvoiceStatus.Overdue => "bg-danger",
            InvoiceStatus.Void => "bg-dark",
            _ => "bg-secondary"
        };
    }

    private class InvoiceEditorModel
    {
        public string? Id { get; set; }
        public string ClientId { get; set; } = string.Empty;

        public int InvoiceNumber { get; set; }
        public InvoiceStatus Status { get; set; } = InvoiceStatus.Draft;
        public InvoiceType Type { get; set; } = InvoiceType.Invoice;

        public string Currency { get; set; } = "CAD";
        public DateOnly IssueDate { get; set; }
        public DateOnly DueDate { get; set; }

        public string? Notes { get; set; }

        public List<InvoiceLineItemModel> LineItems { get; set; } = new();

        public decimal SubTotal { get; set; }
        public decimal Tax { get; set; }
        public decimal Total { get; set; }

        public DateTime? SentAtUtc { get; set; }
        public DateTime? PaidAtUtc { get; set; }

        public PaymentMethod PaymentMethod { get; set; } = PaymentMethod.None;
        public string? PaymentReference { get; set; }

        public bool IsNew => Id == null;
    }

    private class InvoiceLineItemModel
    {
        public string Description { get; set; } = string.Empty;
        public decimal Quantity { get; set; } = 1;
        public decimal UnitPrice { get; set; }
        public decimal TaxRate { get; set; }
        public decimal LineTotal { get; set; }
    }
}

<style>
    .invoices-page {
        display: grid;
        grid-template-columns: minmax(260px, 340px) minmax(0, 1fr);
        gap: 1.25rem;
    }

    .invoices-list-pane {
        display: flex;
        flex-direction: column;
    }

    .toolbar {
        margin-bottom: .75rem;
    }

    .invoices-list {
        max-height: calc(100vh - 240px);
        overflow-y: auto;
    }

    .invoice-card {
        padding: .6rem .7rem;
        border-radius: .7rem;
        background: #020617;
        border: 1px solid #111827;
        margin-bottom: .4rem;
        cursor: pointer;
        font-size: .85rem;
    }

    .invoice-card:hover {
        border-color: #4b5563;
    }

    .invoice-card.selected {
        border-color: #22c55e;
        background: radial-gradient(circle at top left, #22c55e22, #020617);
    }

    .invoice-num {
        font-weight: 600;
        color: #e5e7eb;
    }

    .invoice-client {
        color: #9ca3af;
        font-size: .8rem;
    }

    .invoice-date {
        color: #6b7280;
        font-size: .75rem;
    }

    .invoices-editor-pane {
        padding: .75rem 1rem;
        border-radius: .75rem;
        background: #020617;
        border: 1px solid #1f2937;
    }

    .totals-box {
        display: inline-block;
        min-width: 220px;
        padding: .75rem;
        border-radius: .75rem;
        border: 1px solid #374151;
        background: #020617;
        font-size: .9rem;
    }

    .total-amount {
        font-size: 1.1rem;
    }

    .editor-footer {
        display: flex;
        align-items: center;
    }

    .empty-state {
        padding: 1rem;
        border-radius: .75rem;
        border: 1px dashed #374151;
        background: #020617;
    }

    .empty-state .hint {
        margin-top: .25rem;
        font-size: .85rem;
        color: #9ca3af;
    }
</style>
